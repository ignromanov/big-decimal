import { BD } from "@/core";
import { beforeAll, describe, it } from "vitest";
import { eq } from "~/setup";

beforeAll(() => {
  BD.config({
    DECIMAL_PLACES: 20,
    ROUNDING_MODE: 1,
    EXPONENTIAL_AT: [-7, 21],
    POWER_RANGE: [-1e20, 1e20],
    ALPHABET: "0123456789abcdefghijklmnopqrstuvwxyz",
    POW_PRECISION: 0,
    MODULO_MODE: 1,
    STRICT_MODE: false,
    DEFAULT_BASE: 10,
  });
});

describe("basic abs", () => {
  const basicAbsCases = [
    [1, "1"],
    [-1, "1"],
    [0, "0"],
    [-0, "0"],

    // Numbers with trailing zeros
    ["-1.2300", "1.23"],
    ["1.2300", "1.23"],
    ["1.0", "1"],
    ["-1.0", "1"],
    ["100.00", "100"],
    ["-100.00", "100"],

    // Very small numbers
    ["0.000123", "0.000123"],
    ["-0.000123", "0.000123"],

    // Very large numbers
    ["123456789.123456789", "123456789.123456789"],
    ["-123456789.123456789", "123456789.123456789"],
  ] as const;

  it.each(basicAbsCases)("should abs %s to get %s", (input, expected) => {
    eq(expected, BD.from(input).abs(), `[input: ${input}]`);
  });
});

describe("various abs", () => {
  const two_30 = 1 << 30;
  const two_31 = 2 * two_30;

  const variousAbsCases = [
    [1, 1],
    [1, -1],
    [0.5, "0.5"],
    [0.5, "-0.5"],
    [0.1, 0.1],
    [0.1, -0.1],
    [1.1, 1.1],
    [1.5, "1.5"],
    [1.5, "-1.5"],
    [0.00001, "-1e-5"],
    [9000000000, "-9e9"],
    [123456.7891011, "-123456.7891011"],
    [999.999, "-999.999"],
    [99, 99],
    [1, "-1"],
    [0.001, "0.001"],
    [0.001, "-0.001"],
    [0, 0],
    [0, -0],

    [0, 0],
    [0, -0],
    [0, "-0"],

    [Number.MIN_VALUE, Number.MIN_VALUE],
    [Number.MIN_VALUE, -Number.MIN_VALUE],
    [Number.MAX_VALUE, Number.MAX_VALUE],
    [Number.MAX_VALUE, -Number.MAX_VALUE],

    [two_30, two_30],
    [two_30, -two_30],

    [two_30 + 1, two_30 + 1],
    [two_30 + 1, -two_30 - 1],

    [two_30 - 1, two_30 - 1],
    [two_30 - 1, -two_30 + 1],

    [two_31, two_31],
    [two_31, -two_31],

    [two_31 + 1, two_31 + 1],
    [two_31 + 1, -two_31 - 1],

    [two_31 - 1, two_31 - 1],
    [two_31 - 1, -two_31 + 1],

    ["0", "0"],
    ["1", "-1"],
    ["11.121", "11.121"],
    ["0.023842", "-0.023842"],
    ["1.19", "-1.19"],
    ["9.622e-11", "-0.00000000009622"],
    ["5.09e-10", "-0.000000000509"],
    ["3838.2", "3838.2"],
    ["127", "127.0"],
    ["4.23073", "4.23073"],
    ["2.5469", "-2.5469"],
    ["29949", "-29949"],
    ["277.1", "-277.10"],
    ["4.97898e-15", "-0.00000000000000497898"],
    ["53.456", "53.456"],
    ["100564", "-100564"],
    ["12431.9", "-12431.9"],
    ["97633.7", "-97633.7"],
    ["220", "220"],
    ["188.67", "-188.67"],
    ["35", "-35"],
    ["2.6", "-2.6"],
    ["2.2e-19", "-0.000000000000000000220"],
    ["1.469", "-1.469"],
    ["150.7", "-150.7"],
    ["74", "-74"],
    ["3.52e-9", "-0.00000000352"],
    ["2221.7", "-2221.7"],
    ["0.000004211", "-0.000004211"],
    ["1", "-1"],
    ["5.886", "-5.886"],
    ["16", "16"],
    ["4.4493e-9", "0.0000000044493"],
    ["47.6", "47.6"],
    ["1.6", "-1.60"],
    ["1", "-1"],
    ["1.5", "-1.5"],
    ["5", "-5"],
    ["1", "-1"],
    ["8027", "8027"],
    ["6.36e-16", "-0.000000000000000636"],
    ["3.87766", "3.87766"],
    ["7.4", "-7.4"],
    ["4.449", "-4.449"],
    ["5.2218e-19", "-0.000000000000000000522180"],
    ["1.3769e-11", "-0.000000000013769"],
    ["7.898e-13", "-0.0000000000007898"],
    ["522.9", "-522.9"],
    ["16.1", "-16.1"],
    ["2.15", "2.15"],
    ["4.3", "4.3"],
    ["3", "-3"],
    ["2.8", "-2.8"],
    ["1", "-1"],
    ["0.0000128696", "-0.0000128696"],
    ["13.33", "-13.33"],
    ["0.00000132177", "-0.00000132177"],
    ["1.41516", "-1.41516"],
    ["180.4", "-180.4"],
    ["115079", "-115079"],
    ["959", "959"],
    ["714.4", "714.4"],
    ["1.4544", "1.4544"],
    ["53.691", "53.691"],
    ["2.03832e-12", "-0.00000000000203832"],
    ["1", "-1"],
    ["10.8", "10.8"],
    ["6189.2", "-6189.2"],
    ["6.30866", "6.30866"],
    ["62306", "62306"],
    ["4", "-4.0"],
    ["997.1", "-997.1"],
    ["27.4", "-27.40"],
    ["9242", "9242"],
    ["31.1", "-31.1"],
    ["23.4", "23.4"],
    ["451818", "-451818"],
    ["7", "-7"],
    ["1.9", "-1.9"],
    ["2", "-2"],
    ["112.983", "-112.983"],
    ["9.36e-8", "-0.0000000936"],
    ["12.8515", "12.8515"],
    ["73.1", "-73.1"],
    ["18.15", "18.150"],
    ["11997.8", "11997.8"],
    ["23.1", "-23.1"],
    ["82.022", "-82.022"],
    ["3.916e-20", "-0.00000000000000000003916"],
    ["3.3", "-3.3"],
    ["892.1", "-892.1"],
    ["24.4", "24.4"],
    ["72", "72.0"],
    ["0.0013346", "0.0013346"],
    ["10.4", "-10.4"],
    ["367.5", "367.5"],
    ["7", "-7"],
    ["127.195", "127.195"],
    ["7.89e-13", "-0.000000000000789"],
    ["63", "-63"],
    ["85821.2", "-85821.2"],
    ["95.6", "95.6"],
    ["8.9e-14", "-0.000000000000089"],
    ["112.1", "-112.1"],
    ["3.68", "-3.68"],
    ["9", "-9"],
    ["0.0000975", "-0.0000975"],
    ["393.6", "-393.6"],
    ["7.4", "-7.4"],
    ["69.62", "-69.62"],
    ["5201.3", "5201.3"],
    ["163", "163"],
    ["4.30732", "4.30732"],
    ["224.49", "-224.49"],
    ["319.8", "-319.8"],
    ["88.1", "-88.1"],
    ["2.7762e-8", "0.000000027762"],
    ["2.043e-7", "-0.0000002043"],
    ["75459.3", "-75459.3"],
    ["0.178", "0.178"],
    ["0.00001633", "0.00001633"],
    ["955", "955"],
    ["373898", "-373898"],
    ["9780.1", "9780.1"],
    ["503.47", "503.47"],
    ["3.44562", "-3.44562"],
    ["1.6", "-1.6"],
    ["1.22442", "-1.22442"],
    ["1.4", "1.4"],
    ["1219.1", "-1219.1"],
    ["2.7", "-2.7"],
    ["1057", "-1057"],
    ["1938", "1938"],
    ["1.1983", "1.1983"],
    ["0.0012", "-0.0012"],
    ["95.713", "-95.713"],
    ["2", "-2"],
    ["17.24", "-17.24"],
    ["10.3", "-10.3"],
    ["1", "-1"],
    ["65.8", "-65.8"],
    ["2.9", "2.9"],
    ["54149", "54149"],
    ["8", "-8"],
    ["1", "1.0"],
    ["4", "-4"],
    ["6.3", "-6.3"],
    ["5.25e-9", "0.00000000525"],
    ["52.3", "-52.3"],
    ["75290", "-75290"],
    ["5.9", "-5.9"],
    ["13.7", "13.7"],
    ["2.3982e-9", "0.0000000023982"],
    ["91.5", "-91.50"],
    ["2072.39", "2072.39"],
    ["385.6", "385.6"],
    ["4.77", "4.77"],
    ["18.72", "18.720"],
    ["2817", "-2817"],
    ["44535", "-44535"],
    ["655", "655"],
    ["2e-15", "-0.0000000000000020"],
    ["0.625", "0.6250"],
    ["2", "-2"],
    ["5.315", "5.315"],
    ["70.9", "70.90"],
    ["6.4", "6.4"],
    ["1824", "1824"],
    ["52.595", "52.595"],
    ["3662", "3662.0"],
    ["3.1", "3.1"],
    ["1.05032e-7", "0.000000105032"],
    ["997.063", "-997.063"],
    ["41746", "-41746"],
    ["24.0402", "24.0402"],
    ["0.009135", "0.009135"],
    ["2.34e-9", "-0.00000000234"],
    ["13.1", "13.1"],
    ["228.8", "228.8"],
    ["565.85", "565.85"],
    ["4e-20", "0.000000000000000000040"],
    ["1.73", "1.73"],
    ["38.9", "38.9"],
    ["1.02e-14", "-0.0000000000000102"],
    ["302.8", "-302.8"],
    ["7", "-7"],
    ["1", "-1"],
    ["0.00247", "0.00247"],
    ["2", "-2"],
    ["3.26", "-3.26"],
    ["8.8", "8.8"],
    ["90.6", "90.6"],
    ["8.3053e-17", "-0.000000000000000083053"],
    ["2.5", "-2.5"],
    ["376.2", "-376.2"],
    ["1.29", "1.29"],
    ["1.379", "-1.379"],
    ["40921.5", "-40921.5"],
    ["1", "-1"],
    ["12.5", "12.5"],
    ["10.1", "10.1"],
    ["1", "-1"],
    ["226636", "226636"],
    ["1", "-1"],
    ["1.7", "-1.7"],
    ["31.31", "31.31"],
    ["79.9", "-79.9"],
    ["4.027e-13", "0.0000000000004027"],
    ["43.838", "43.838"],
    ["6.47", "-6.47"],
    ["5.292e-19", "0.0000000000000000005292"],
    ["4.6", "-4.6"],
    ["15918", "-15918.0"],
    ["239.45", "239.45"],
    ["1.02", "-1.02"],
    ["14101", "-14101"],
    ["7", "-7"],
    ["367.34", "367.34"],
    ["5", "-5"],
    ["19.9", "-19.9"],
    ["269.45", "-269.45"],
    ["10.34", "-10.34"],
    ["3.32882e-12", "-0.00000000000332882"],
    ["5.9", "5.9"],
    ["9", "-9.0"],
    ["1.3597", "-1.3597"],
    ["8", "8.0"],
    ["1", "1.0"],
    ["312.5", "312.5"],
    ["1.554", "-1.554"],
    ["210.985", "-210.985"],
    ["1", "-1"],
    ["1.24", "-1.24"],
    ["513865", "-513865"],
    ["6748", "-6748"],
    ["591.51", "-591.51"],
    ["2.2", "-2.2"],
    ["19.5495", "19.5495"],
    ["3.3", "3.3"],
    ["30", "-30"],
    ["94", "-94"],
    ["217.55", "217.55"],
    ["2", "-2"],
    ["99", "99"],
    ["4.067", "-4.067"],
    ["702.57", "702.57"],
    ["3.7", "-3.70"],
    ["4", "4.0"],
    ["192944", "192944"],
    ["0.000022", "0.000022"],
    ["47.6", "47.60"],
    ["0.391", "0.3910"],
    ["35", "-35"],
    ["100", "-100"],
    ["3.3", "-3.3"],
    ["32.432", "32.432"],
    ["1.07849e-18", "0.00000000000000000107849"],
    ["2", "-2.0"],
    ["23.27", "23.27"],
    ["4.054e-15", "-0.000000000000004054"],
    ["7.6", "-7.6"],
    ["1305", "1305"],
    ["1.501", "-1.501"],
    ["3.4", "3.4"],
    ["22.5", "-22.5"],
    ["1.0916", "1.0916"],
    ["2", "-2"],
    ["58.271", "58.271"],
    ["1.73e-12", "0.00000000000173"],
    ["1.3458e-15", "0.0000000000000013458"],
    ["309.87", "-309.87"],
    ["5.318", "-5.318"],
    ["1.5302e-8", "0.000000015302"],
    ["596765", "596765"],
    ["54.42", "-54.42"],
    ["6.549e-20", "0.00000000000000000006549"],
    ["29", "29"],
    ["46.025", "46.025"],
    ["2556.78", "-2556.78"],
    ["0.00287721", "0.00287721"],
    ["1.63", "-1.63"],
    ["0.00041", "0.00041"],
    ["698", "698"],
    ["134.4", "134.4"],
    ["2.1", "2.1"],
    ["2.07", "-2.07"],
    ["122.869", "122.869"],
    ["0.00017", "-0.00017"],
    ["18.6", "18.6"],
    ["7", "-7"],
    ["0.0180557", "0.0180557"],
    ["5", "-5"],
    ["6.2", "-6.2"],
    ["8", "-8"],
    ["450.96", "-450.96"],
    ["20.2", "-20.2"],
    ["176.52", "176.52"],
    ["0.00017", "-0.000170"],
    ["5", "-5"],
    ["1", "-1"],
    ["1.37856e-14", "0.0000000000000137856"],
    ["76.3048", "76.3048"],
    ["1803.7", "-1803.7"],
    ["74", "74"],
    ["1.7e-12", "0.0000000000017"],
    ["48.7", "-48.7"],
    ["4.48", "-4.48"],
    ["1.4", "-1.4"],
    ["7.69", "-7.69"],
    ["23.5987", "23.5987"],
    ["3074", "3074.0"],
    ["8.06e-15", "-0.00000000000000806"],
    ["21.3757", "-21.3757"],
    ["35", "35"],
    ["11.056", "11.0560"],
    ["3.36e-14", "-0.0000000000000336"],
    ["49139.4", "-49139.4"],
    ["32.654", "-32.654"],
    ["34035.4", "34035.4"],
    ["15.22", "15.22"],
    ["62", "62.0"],
    ["8.89156", "-8.89156"],
    ["14", "14"],
    ["0.006", "-0.0060"],
    ["1.5", "1.5"],
    ["7", "-7"],
    ["1.6e-11", "0.000000000016"],
    ["26.6427", "26.6427"],
    ["1.5e-18", "-0.0000000000000000015"],
    ["1.52838e-15", "0.00000000000000152838"],
    ["119.1", "119.1"],
    ["0.004283", "0.004283"],
    ["818", "-818"],
    ["194", "194"],
    ["104.788", "-104.788"],
    ["3.74e-11", "0.0000000000374"],
    ["6.162", "-6.162"],
    ["5.19214e-18", "-0.00000000000000000519214"],
    ["1.4", "-1.4"],
    ["1.27", "-1.27"],
    ["7.83822e-12", "-0.00000000000783822"],
    ["1", "-1"],
    ["4.4", "4.4"],
    ["7.37382e-12", "0.00000000000737382"],
    ["13.618", "13.618"],
    ["1.03", "-1.03"],
    ["3.7457e-13", "0.00000000000037457"],
    ["5.2", "-5.2"],
    ["3.5", "3.5"],
    ["364", "-364"],
    ["7.336", "7.336"],
    ["1.1447e-16", "-0.00000000000000011447"],
    ["510.63", "-510.63"],
    ["5.8", "5.8"],
    ["7.8", "7.8"],
    ["2.96", "-2.96"],
    ["15.64", "-15.64"],
    ["187863", "-187863"],
    ["2.73", "-2.73"],
    ["2.671", "-2.671"],
    ["18.179", "-18.179"],
    ["855885", "855885"],
    ["4.16", "4.16"],
    ["5.722e-18", "0.000000000000000005722"],
    ["67.62", "67.62"],
    ["813.31", "813.31"],
    ["40.2", "40.20"],
    ["0.00002515", "0.00002515"],
    ["0.0196", "0.01960"],
    ["13.165", "13.165"],
    ["6.743", "-6.743"],
    ["1", "-1"],
    ["200.56", "-200.56"],
    ["1.932", "1.932"],
    ["92.9", "92.90"],
    ["16.74", "16.74"],
    ["4.5554e-7", "-0.00000045554"],
    ["2.1296e-15", "-0.0000000000000021296"],
    ["2.088", "2.088"],
    ["2577", "2577"],
    ["45.4", "-45.4"],
    ["41.3", "-41.3"],
    ["3.63", "-3.63"],
    ["1.09", "-1.09"],
    ["1", "-1"],
    ["3.7", "-3.7"],
    ["204.54", "204.54"],
    ["235.6", "235.6"],
    ["384", "-384"],
    ["0.0207", "0.02070"],
    ["680", "680"],
    ["1.09", "1.09"],
    ["109.2", "109.2"],
    ["0.00010117", "0.00010117"],
    ["13.81", "13.81"],
    ["192.3", "192.3"],
    ["1", "-1"],
    ["1.2", "1.2"],
    ["4.1", "-4.1"],
    ["2.5", "2.5"],
    ["8.4076", "-8.4076"],
    ["0.0517", "0.0517"],
    ["6.3923", "-6.3923"],
    ["506.179", "-506.179"],
    ["375886", "375886"],
    ["618858", "-618858"],
    ["8.5e-11", "0.000000000085"],
    ["6", "-6.0"],
    ["2.4", "2.40"],
    ["0.0000013", "-0.0000013"],
    ["1.064", "-1.064"],
    ["1", "-1"],
    ["4", "-4"],
    ["4.5", "-4.5"],
    ["93.6206", "93.6206"],
    ["3.07e-18", "0.00000000000000000307"],

    ["52.452468128", "-5.2452468128e+1"],
    ["14152590525718936.5008396", "1.41525905257189365008396e+16"],
    ["274306808392.8", "2.743068083928e+11"],
    ["1.52993064722314247378724599e+26", "-1.52993064722314247378724599e+26"],
    ["37205576746", "3.7205576746e+10"],
    ["868099644460934347.2665", "8.680996444609343472665e+17"],
    ["1254.549", "1.254549e+3"],
    [
      "6.23417196172381875892300762819e-18",
      "6.23417196172381875892300762819e-18",
    ],
    ["13117994082191928443.1", "1.31179940821919284431e+19"],
    ["97697726.168", "9.7697726168e+7"],
    ["2.663e-10", "-2.663e-10"],
    ["1052", "1.052e+3"],
    ["3.815873266712e-20", "-3.815873266712e-20"],
    ["18", "1.8e+1"],
    [
      "1.033525906631680944018544811261e-13",
      "1.033525906631680944018544811261e-13",
    ],
    ["3.805493087068952925e-11", "-3.805493087068952925e-11"],
    ["0.0173948", "1.73948e-2"],
    ["5.784e-15", "5.784e-15"],
    ["4.448338479762497e-8", "4.448338479762497e-8"],
    ["390080230.52", "3.9008023052e+8"],
    ["3", "3e+0"],
    ["8.61435e-9", "8.61435e-9"],
    ["43.7", "-4.37e+1"],
    ["8.4034159379836e-18", "-8.4034159379836e-18"],
    ["20028573.55721079885824481", "2.002857355721079885824481e+7"],
    ["7000871.862", "-7.000871862e+6"],
  ] as const;

  it.each(variousAbsCases)("should abs %s to get %s", (expected, input) => {
    eq(expected.toString(), BD.from(input).abs(), `[input: ${input}]`);
  });
});
